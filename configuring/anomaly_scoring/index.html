<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.85.0"><meta name=description content="CoreRuleSet Documentation"><meta name=author content="CoreRuleSet"><link rel=icon href=/documentation/images/favicon.png type=image/png><title>Anomaly Scoring :: Core Rule Set Documentation</title><link href=/documentation/css/nucleus.css?1637268075 rel=stylesheet><link href=/documentation/css/fontawesome-all.min.css?1637268075 rel=stylesheet><link href=/documentation/css/featherlight.min.css?1637268075 rel=stylesheet><link href=/documentation/css/perfect-scrollbar.min.css?1637268075 rel=stylesheet><link href=/documentation/css/auto-complete.css?1637268075 rel=stylesheet><link href=/documentation/css/theme.css?1637268075 rel=stylesheet><link href=/documentation/css/theme-blue.css?1637268075 rel=stylesheet><link href=/documentation/css/variant.css?1637268075 rel=stylesheet><link href=/documentation/css/print.css?1637268075 rel=stylesheet media=print><script src=/documentation/js/jquery.min.js?1637268075></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/documentation/configuring/anomaly_scoring/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=https://coreruleset.github.io/documentation/><img src=https://coreruleset.github.io/documentation//images/logo.png></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script src=/documentation/js/lunr.min.js?1637268075></script><script src=/documentation/js/auto-complete.js?1637268075></script><script>var index_url="/documentation/index.json",root_url="/",baseUri=root_url.replace(/\/$/,'')</script><script src=/documentation/js/search.js?1637268075></script></div><div id=homelinks><ul><li><a class=padding href=/documentation/><i class="fas fa-home"></i> Home</a></li></ul></div><div class=highlightable><ul class=topics><li data-nav-id=/documentation/deployment/ title="Getting CRS" class=dd-item><a href=/documentation/deployment/><b>1. </b>Getting CRS<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/deployment/engine_integration_options/ title="Engine and Integration Options" class=dd-item><a href=/documentation/deployment/engine_integration_options/>Engine and Integration Options<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/deployment/quickstart/ title="OWASP CRS Quickstart" class=dd-item><a href=/documentation/deployment/quickstart/>Quickstart<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/deployment/install/ title="Installing CoreRuleSet" class=dd-item><a href=/documentation/deployment/install/>Extended Install<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/configuring/ title="How it Works" class="dd-item parent"><a href=/documentation/configuring/><b>2. </b>How it Works<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/configuring/anomaly_scoring/ title="Anomaly Scoring" class="dd-item active"><a href=/documentation/configuring/anomaly_scoring/>Anomaly Scoring<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/configuring/paranoia_levels/ title="Paranoia Levels" class=dd-item><a href=/documentation/configuring/paranoia_levels/>Paranoia Levels<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/configuring/plugins/ title=Plugins class=dd-item><a href=/documentation/configuring/plugins/>Plugins<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/configuring/crs/ title=Configuration class=dd-item><a href=/documentation/configuring/crs/>Configuration<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/configuring/exceptions/ title="Adding Exceptions and Tuning CRS" class=dd-item><a href=/documentation/configuring/exceptions/>Exceptions<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/operation/ title=Operation class=dd-item><a href=/documentation/operation/>Operation<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/operation/containers/ title="Using Containers" class=dd-item><a href=/documentation/operation/containers/>Using Containers<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/operation/log_handling/ title="Log Handling" class=dd-item><a href=/documentation/operation/log_handling/>Log Handling<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/rules/ title="Creating Rules" class=dd-item><a href=/documentation/rules/><b>3. </b>Rules<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/rules/ruleid/ title="Rule IDs" class=dd-item><a href=/documentation/rules/ruleid/><b>1. </b>Rule IDs<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/rules/testing/ title="Testing the Rule Set" class=dd-item><a href=/documentation/rules/testing/><b>2. </b>Testing<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/rules/rules/ title=Rules class=dd-item><a href=/documentation/rules/rules/><b>3. </b>Rules<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/rules/creating/ title=Making class=dd-item><a href=/documentation/rules/creating/><b>9. </b>Making<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/rules/metadata/ title=Metadata class=dd-item><a href=/documentation/rules/metadata/><b>10. </b>Metadata<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/development/ title=Development class=dd-item><a href=/documentation/development/><b>4. </b>Development<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/documentation/development/rule_writing/ title="Writing CRS Rules" class=dd-item><a href=/documentation/development/rule_writing/>Writing CRS Rules<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/plugin_writing/ title="Writing Plugins" class=dd-item><a href=/documentation/development/plugin_writing/>Writing Plugins<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/documentation/development/sandbox/ title="Using the CRS Sandbox" class=dd-item><a href=/documentation/development/sandbox/>Using the CRS Sandbox<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/documentation/resources/ title="Additional Resources" class=dd-item><a href=/documentation/resources/>Additional Resources<i class="fas fa-check read-icon"></i></a><ul></ul></li></ul><div id=shortcuts><div class=nav-title>More</div><ul><li><a class=padding href=https://coreruleset.org/><i class="fas fa-bookmark"></i> Core Rule Set Home</a></li><li><a class=padding href=https://github.com/coreruleset/coreruleset><i class="fab fa-github"></i> Core Rule Set GitHub</a></li></ul></div><div id=prefooter><hr><ul><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></div><div id=footer><p>Built with <a href=https://github.com/McShelby/hugo-theme-relearn><i class="fas fa-heart"></i></a> by <a href=https://gohugo.io/>Hugo</a></p></div></div></nav><div id=body><div id=overlay></div><div class="padding highlightable"><div id=top-bar><div id=top-github-link><a class=github-link title="Edit this page" href=https://github.com/coreruleset/documentation/blob/main/content/configuring/anomaly_scoring.md target=blank><i class="fas fa-code-branch"></i>
<span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links>Anomaly Scoring</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#overview-of-anomaly-scoring>Overview of Anomaly Scoring</a></li><li><a href=#how-anomaly-scoring-mode-works>How Anomaly Scoring Mode Works</a><ul><li><a href=#summary-of-anomaly-scoring-mode>Summary of Anomaly Scoring Mode</a></li></ul></li><li><a href=#anomaly-scoring-mode>Anomaly Scoring Mode</a><ul><li><a href=#configuring-anomaly-scoring-mode>Configuring Anomaly Scoring Mode</a></li><li><a href=#anomaly-scoring-severity-levels>Anomaly Scoring Severity Levels</a></li><li><a href=#enabledisable-blocking>Enable/Disable Blocking</a></li><li><a href=#pros-and-cons-of-anomaly-scoring-detection-mode>Pros and Cons of Anomaly Scoring Detection Mode</a></li><li><a href=#traditional-detection-mode-deprecated>Traditional Detection Mode (deprecated)</a></li><li><a href=#configuring-traditional-mode>Configuring Traditional Mode</a></li><li><a href=#pros-and-cons-of-traditional-detection-mode>Pros and Cons of Traditional Detection Mode</a></li></ul></li></ul></nav></div></div></div><div id=head-tags></div><main id=body-inner><h1>Anomaly Scoring</h1><blockquote><p>The Core Rule Set 3 is designed as an anomaly scoring rule set. This page explains what anomaly scoring is and how to use it.</p></blockquote><h2 id=overview-of-anomaly-scoring>Overview of Anomaly Scoring</h2><p>Anomaly scoring, also known as &ldquo;collaborative detection&rdquo;, is a scoring mechanism used in the Core Rule Set. It assigns a numeric score to HTTP requests and responses, representing how &lsquo;anomalous&rsquo; they appear to be. Anomaly scores can then be used to make blocking decisions. The default CRS blocking policy, for example, is to block any transaction that exceeds a defined anomaly score threshold.</p><h2 id=how-anomaly-scoring-mode-works>How Anomaly Scoring Mode Works</h2><p>Anomaly scoring mode combines the concepts of <em>collaborative detection</em> and <em>delayed blocking</em>. The key idea to understand is that <strong>the inspection/detection rule logic is decoupled from the blocking functionality</strong>.</p><p>Individual rules designed to detect specific types of attacks and malicious behaviour are executed. If a rule matches, no immediate disruptive action is taken (e.g. the transaction is not blocked). Instead, the matched rule contributes to a transactional <em>anomaly score</em>, which acts as a running total. The rules just handle detection, adding to the anomaly score if they match. In addition, an individual matched rule will typically log a record of the match for later reference, including the ID of the matched rule, the data that caused the match, and the URI that was being requested.</p><p>Once all of the rules that inspect <em>request</em> data have been executed, <em>blocking evaluation</em> takes place. If the anomaly score is greater than or equal to the inbound anomaly score threshold then the transaction is <em>denied</em>. Transactions that are not denied continue on their journey.</p><p><img src=as_inbound_no_fonts.svg alt="Diagram showing an example where the inbound anomaly score threshold is set to 5. A first example request accumulates an anomaly score of 7 and is denied at the blocking evaluation step. A second example request accumulates no anomaly score and is allowed to pass at the blocking evaluation step."></p><p>Continuing on, once all of the rules that inspect <em>response</em> data have been executed, a second round of blocking evaluation takes place. If the <em>outbound</em> anomaly score is greater than or equal to the outbound anomaly score threshold then the transaction is <em>denied</em>.</p><div class="notices info"><div class=label>Info</div><p>Having separate inbound and outbound anomaly scores and thresholds allows for request data and response data to be inspected and scored independently.</p></div><h3 id=summary-of-anomaly-scoring-mode>Summary of Anomaly Scoring Mode</h3><p>To summarise, anomaly scoring mode in the CRS works like so:</p><ol><li>Execute all <em>request</em> rules</li><li>Make a blocking decision using the <em>inbound</em> anomaly score threshold</li><li>Execute all <em>response</em> rules</li><li>Make a blocking decision using the <em>outbound</em> anomaly score threshold</li></ol><div class="notices warning"><div class=label>Warning</div><p>From version 3.0 onwards, Anomaly Scoring is the default detection mode. Traditional detection mode is discouraged.</p></div><p>Within the <code>csr-setup.conf.example</code> you can control the following related CRS items:</p><ul><li>Anomaly Scoring Severity Levels</li><li>Anomaly Scoring Threshold Levels (Blocking)</li><li>Enable/Disable Blocking</li><li>Choose the default logging actions</li><li>and much more!</li></ul><h2 id=anomaly-scoring-mode>Anomaly Scoring Mode</h2><h3 id=configuring-anomaly-scoring-mode>Configuring Anomaly Scoring Mode</h3><p>The default mode in CRS 3.x is Anomaly Scoring mode, you can verify this
is your mode by checking that the SecDefaultAction line in the
csr-setup.conf file usees the pass action:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-apache data-lang=apache>SecDefaultAction <span style=color:#e6db74>&#34;phase:2,pass,log&#34;</span>
</code></pre></div><p>In this mode, each matched rule will not block, but rather will
increment anomaly scores using ModSecurity's setvar action. Here is an
example of an SQL Injection CRS rule that is using setvar actions to
increase both the overall anomaly score and the SQL Injection
sub-category score:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-apache data-lang=apache>SecRule ARGS|REQUEST_COOKIES|QUERY_STRING|REQUEST_FILENAME <span style=color:#e6db74>&#34;@detectSQLi&#34;</span> \
   <span style=color:#960050;background-color:#1e0010>&#34;</span>msg:&#39;SQL Injection Attack Detected via LibInjection&#39;,\
   id:942100,\
   rev:&#39;1&#39;,\
   ver:&#39;OWASP_CRS/3.0.0&#39;,\
   maturity:&#39;1&#39;,\
   accuracy:&#39;8&#39;,\
   phase:request,\
   block,\
   multiMatch,\
   t:none,t:utf8toUnicode,t:urlDecodeUni,t:removeNulls,t:removeComments,\
   capture,\
   logdata:&#39;Matched Data: %{TX.0} found within %{MATCHED_VAR_NAME}: %{MATCHED_VAR}&#39;,\
   tag:&#39;application-multi&#39;,\
   tag:&#39;language-multi&#39;,\
   tag:&#39;platform-multi&#39;,\
   tag:&#39;attack-sqli&#39;,\
   tag:&#39;OWASP_CRS/WEB_ATTACK/SQL_INJECTION&#39;,\
   tag:&#39;WASCTC/WASC-19&#39;,\
   tag:&#39;OWASP_TOP_10/A1&#39;,\
   tag:&#39;OWASP_AppSensor/CIE1&#39;,\
   tag:&#39;PCI/6.5.2&#39;,\
   setvar:tx.anomaly_score=+%{tx.critical_anomaly_score},\
   setvar:tx.sql_injection_score=+%{tx.critical_anomaly_score},\
   setvar:&#39;tx.msg=%{rule.msg}&#39;,setvar:tx.%{rule.id}-OWASP_CRS/WEB_ATTACK/SQL_INJECTION-%{matched_var_name}=%{matched_var}<span style=color:#960050;background-color:#1e0010>&#34;</span>
</code></pre></div><h3 id=anomaly-scoring-severity-levels>Anomaly Scoring Severity Levels</h3><p>Each rule has a severity level specified. We have updated the rules to
allow for the anomaly score collection incrementation to use macro
expansion. Below is a snippet from the above rule <em>(id:942100)</em> where that
occurs:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-apache data-lang=apache><span style=color:#960050;background-color:#1e0010>setvar:tx</span>.<span style=color:#960050;background-color:#1e0010>anomaly_score=+%{tx</span>.<span style=color:#960050;background-color:#1e0010>critical_anomaly_score},\</span>
<span style=color:#960050;background-color:#1e0010>setvar:tx</span>.<span style=color:#960050;background-color:#1e0010>sql_injection_score=+%{tx</span>.<span style=color:#960050;background-color:#1e0010>critical_anomaly_score},\</span>
</code></pre></div><p>This adds a variable amount, <em>tx.critical_anomaly_score</em>, to the current
anomaly scores. The user can configure what each score represents from
within the csr-setup.conf file and these scores will be propagated out
for use in the rules by using macro expansion. The following is an
excerpt from csr-setup.conf where that configuration is set:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-apache data-lang=apache><span style=color:#75715e>#</span>
<span style=color:#75715e># -=[ Anomaly Scoring Severity Levels ]=-</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e># These are the default scoring points for each severity level.  You may</span>
<span style=color:#75715e># adjust these to you liking.  These settings will be used in macro expansion</span>
<span style=color:#75715e># in the rules to increment the anomaly scores when rules match.</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e># These are the default Severity ratings (with anomaly scores) of the individual rules -</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e>#    - 2: Critical - Anomaly Score of 5.</span>
<span style=color:#75715e>#         Is the highest severity level possible without correlation.  It is</span>
<span style=color:#75715e>#         normally generated by the web attack rules (40 level files).</span>
<span style=color:#75715e>#    - 3: Error - Anomaly Score of 4.</span>
<span style=color:#75715e>#         Is generated mostly from outbound leakage rules (50 level files).</span>
<span style=color:#75715e>#    - 4: Warning - Anomaly Score of 3.</span>
<span style=color:#75715e>#         Is generated by malicious client rules (35 level files).</span>
<span style=color:#75715e>#    - 5: Notice - Anomaly Score of 2.</span>
<span style=color:#75715e>#         Is generated by the Protocol policy and anomaly files.</span>
<span style=color:#75715e>#</span>
<span style=color:#960050;background-color:#1e0010>setvar:tx</span>.<span style=color:#960050;background-color:#1e0010>critical_anomaly_score=5,</span> <span style=color:#960050;background-color:#1e0010>\</span>
<span style=color:#960050;background-color:#1e0010>setvar:tx</span>.<span style=color:#960050;background-color:#1e0010>error_anomaly_score=4,</span> <span style=color:#960050;background-color:#1e0010>\</span>
<span style=color:#960050;background-color:#1e0010>setvar:tx</span>.<span style=color:#960050;background-color:#1e0010>warning_anomaly_score=3,</span> <span style=color:#960050;background-color:#1e0010>\</span>
<span style=color:#960050;background-color:#1e0010>setvar:tx</span>.<span style=color:#960050;background-color:#1e0010>notice_anomaly_score=2&#34;</span>
</code></pre></div><p>This configuration would mean that every CRS rule that has a Severity
rating of &ldquo;Critical&rdquo; would increase the transactional anomaly score by
5 points per rule match. When we have a rule match, you can see how the
anomaly scoring works from within the <code>modsec_debug.log</code> file:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>...
Setting variable: tx.sql_injection_score=+%{tx.critical_anomaly_score}
Recorded original collection variable: tx.sql_injection_score = &#34;0&#34;
Resolved macro %{tx.critical_anomaly_score} to: 5
Relative change: sql_injection_score=0+5
Set variable &#34;tx.sql_injection_score&#34; to &#34;5&#34;.
Setting variable: tx.anomaly_score=+%{tx.critical_anomaly_score}
Recorded original collection variable: tx.anomaly_score = &#34;0&#34;
Resolved macro %{tx.critical_anomaly_score} to: 5
Relative change: anomaly_score=0+5
Set variable &#34;tx.anomaly_score&#34; to &#34;5&#34;.
...
</code></pre></div><p>Now that we have the capability to do anomaly scoring, the next step is
to set our thresholds. This is the score value at which, if the current
transactional score is above, it will be denied. We have various
different anomaly scoring thresholds to set for both specific
vulnerability types and generic requests/response levels. These will be
evaluated in two different files. Inbound request are evaluated at the
end of <code>phase:2</code> in the <code>rules/REQUEST-949-BLOCKING-EVALUATION.conf</code> file and
outbound responses are evaluated at the end of <code>phase:4</code> in the
<code>rules/RESPONSE-959-BLOCKING-EVALUATION.conf</code> file. The thresholds are
configured in the <code>csr-setup.conf</code> file.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-apache data-lang=apache>SecAction \
 <span style=color:#960050;background-color:#1e0010>&#34;</span>id:&#39;900003&#39;,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:tx.sql_injection_score_threshold=15,\
  setvar:tx.xss_score_threshold=15,\
  setvar:tx.rfi_score_threshold=5,\
  setvar:tx.lfi_score_threshold=5,\
  setvar:tx.rce_score_threshold=5,\
  setvar:tx.command_injection_score_threshold=5,\
  setvar:tx.php_injection_score_threshold=5,\
  setvar:tx.http_violation_score_threshold=5,\
  setvar:tx.trojan_score_threshold=5,\
  setvar:tx.session_fixation_score_threshold=5,\
  setvar:tx.inbound_anomaly_score_threshold=5,\
  setvar:tx.outbound_anomaly_score_threshold=4<span style=color:#960050;background-color:#1e0010>&#34;</span>
</code></pre></div><p>With these current default settings, anomaly scoring mode will act
similarly to traditional mode from a blocking perspective. Since all
critical level rules increase the anomaly score by 5 points, this means
that even 1 critical level rule match will cause a block. If you want to
adjust the anomaly score so that you have a lower chance of blocking
non-malicious clients (false positives) you could raise the
tx.inbound_anomaly_score_level settings to something higher like 10
or 15. This would mean that two or more critical severity rules have
matched before you decide to block. Another advantage of this approach
is that you could aggregate multiple lower severity rule matches and
then decide to block. So, one lower severity rule match (such as missing
a Request Header such as Accept) would not result in a block but if
multiple anomalies are triggered then the request would be blocked.</p><h3 id=enabledisable-blocking>Enable/Disable Blocking</h3><p>You are probably familiar with the SecRuleEngine directive which allows
you to control blocking mode (On) vs. Detection mode (DetectionOnly).
With the Anomaly Scoring mode, if you want to allow blocking, you should
set the SecRueEngine to On and then uncomment the following SecAction in
the csr-setup.conf file. Note: this is done by default in CRS 3.x:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-apache data-lang=apache>SecAction \
 <span style=color:#960050;background-color:#1e0010>&#34;</span>id:&#39;900004&#39;,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:tx.anomaly_score_blocking=on<span style=color:#960050;background-color:#1e0010>&#34;</span>
</code></pre></div><p>When this rule is enabled, The rule within the
<code>rules/REQUEST-949-BLOCKING-EVALUATION.conf</code> and
<code>rules/RESPONSE-959-BLOCKING-EVALUATION.conf</code> files will evaluate the
anomaly scores at the end of the request/response phases and will block
the request if it exceeds a given anomaly threshold. An example of such
a rule is as follows:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-apache data-lang=apache>SecRule TX:ANOMALY_SCORE <span style=color:#e6db74>&#34;@ge %{tx.inbound_anomaly_score_threshold}&#34;</span> \
    <span style=color:#960050;background-color:#1e0010>&#34;</span>msg:&#39;Inbound Anomaly Score Exceeded (Total Score: %{TX.ANOMALY_SCORE}, Last Matched Message: %{tx.msg}&#39;,\
    severity:CRITICAL,\
    phase:request,\
    id:949190,\
    t:none,\
    deny,\
    log,\
    tag:&#39;application-multi&#39;,\
    tag:&#39;language-multi&#39;,\
    tag:&#39;platform-multi&#39;,\
    tag:&#39;attack-generic&#39;,\
    setvar:tx.inbound_tx_msg=%{tx.msg},\
    setvar:tx.inbound_anomaly_score=%{tx.anomaly_score},\
    chain<span style=color:#e6db74>&#34;
</span><span style=color:#e6db74>        SecRule TX:ANOMALY_SCORE_BLOCKING &#34;</span>@streq <span style=color:#66d9ef>on</span><span style=color:#e6db74>&#34; chain
</span><span style=color:#e6db74>            SecRule TX:/^\d+\-/ &#34;</span>(.*)<span style=color:#960050;background-color:#1e0010>&#34;</span>
</code></pre></div><p>Notice that there is an explicit deny within this rule. This explitly
listed disruptive action will override the default action of pass
(within anomaly mode)and block the transaction. If you would like a
different action to occur you would set it within the two
BLOCKING-EVALUATION files.</p><h3 id=pros-and-cons-of-anomaly-scoring-detection-mode>Pros and Cons of Anomaly Scoring Detection Mode</h3><p>Pros</p><ul><li>An increased confidence in blocking - since more detection rules
contribute to the anomaly score, the higher the score, the more
confidence you can have in blocking malicious transactions.</li><li>Allows users to set a threshold that is appropriate for them -
different sites may have different thresholds for blocking.</li><li>Allows several low severity events to trigger alerts while
individual ones are suppressed.</li><li>One correlated event helps alert management.</li><li>Exceptions may be handled by either increasing the overall anomaly
score threshold, or by adding local custom exceptions file</li></ul><p>Cons</p><ul><li>More complex for the average user.</li><li>Log monitoring scripts may need to be updated for proper analysis</li></ul><h3 id=traditional-detection-mode-deprecated>Traditional Detection Mode (deprecated)</h3><div class="notices warning"><div class=label>Warning</div><p>Don&rsquo;t use this mode unless you have a ver specific need. You&rsquo;ve been warned.</p></div><p>Traditional Detection Mode (or IDS/IPS mode) is the old default
operating mode. This is the most basic operating mode where all of the
rules are &ldquo;self-contained&rdquo;. In this mode there is no intelligence is
shared between rules and each rule has no information about any previous
rule matches. That is to say, in this mode, if a rule triggers, it will
execute any disruptive/logging actions specified on the current rule.</p><h3 id=configuring-traditional-mode>Configuring Traditional Mode</h3><p>If you want to run the CRS in Traditional mode, you can do this easily
by modifying the SecDefaultAction directive in the csr-setup.conf file
to use a disruptive action other than the default 'pass', such as
deny:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-apache data-lang=apache><span style=color:#75715e># Default (Anomaly Mode)</span>
SecDefaultAction <span style=color:#e6db74>&#34;phase:2,pass,log&#34;</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-apache data-lang=apache><span style=color:#75715e># Updated To Enable Traditional Mode</span>
SecDefaultAction <span style=color:#e6db74>&#34;phase:2,deny,status:403,log&#34;</span>
</code></pre></div><h3 id=pros-and-cons-of-traditional-detection-mode>Pros and Cons of Traditional Detection Mode</h3><p>Pros</p><ul><li>The functionality of this mode is much easier for a new user to
understand.</li><li>Better performance (lower latency/resources) as the first disruptive
match will stop further processing.</li></ul><p>Cons</p><ul><li>Not all rules that could have triggered will be logged, only th
first</li><li>Not every site has the same risk tolerance</li><li>Lower severity alerts may not trigger traditional mode</li><li>Single low severity alerts may not be deemed critical enough to
block, but multiple lower severity alerts in aggregate could be</li></ul><footer class=footline></footer></main></div><div id=navigation><a class="nav nav-prev" href=/documentation/configuring/ title="How it Works"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/documentation/configuring/paranoia_levels/ title="Paranoia Levels"><i class="fa fa-chevron-right"></i></a></div></div><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/documentation/js/clipboard.min.js?1637268075></script><script src=/documentation/js/perfect-scrollbar.min.js?1637268075></script><script src=/documentation/js/perfect-scrollbar.jquery.min.js?1637268075></script><script src=/documentation/js/jquery.svg.pan.zoom.js?1637268075></script><script src=/documentation/js/featherlight.min.js?1637268075></script><script src=/documentation/js/modernizr.custom-3.6.0.js?1637268075></script><script src=/documentation/js/mermaid.min.js?1637268075></script><script>typeof mermaid!='undefined'&&mermaid.mermaidAPI.initialize(Object.assign({securityLevel:"antiscript"},JSON.parse('{ "startOnLoad": true }'),{startOnLoad:!1}))</script><script src=/documentation/js/relearn.js?1637268075></script></body></html>